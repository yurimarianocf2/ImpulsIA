{
  "name": "FarmaBot - Teste de Conex√£o",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "whatsapp-teste",
        "responseMode": "onReceived"
      },
      "name": "Webhook WhatsApp",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300],
      "webhookId": "farmabot-teste"
    },
    {
      "parameters": {
        "functionCode": "// Simular recebimento de mensagem WhatsApp\nconst mensagem = $input.first().json;\n\n// Extrair dados da mensagem\nconst telefone = mensagem.from || '5511999999999';\nconst texto = mensagem.text || mensagem.message || 'teste';\n\nconsole.log('Mensagem recebida:', {\n  telefone,\n  texto,\n  timestamp: new Date().toISOString()\n});\n\n// Preparar resposta\nreturn {\n  telefone: telefone,\n  mensagem_recebida: texto,\n  resposta: `ü§ñ FarmaBot recebeu: \"${texto}\"\n\n‚úÖ Sistema funcionando!\nüì± Telefone: ${telefone}\n‚è∞ Hor√°rio: ${new Date().toLocaleString('pt-BR')}\n\nüîç Digite \"pre√ßo dipirona\" para testar busca de produtos!`,\n  status: 'processado',\n  farmacia: 'Farm√°cia S√£o Jo√£o'\n};"
      },
      "name": "Processar Mensagem",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [460, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json[\"mensagem_recebida\"].toLowerCase()}}",
              "operation": "contains",
              "value2": "pre√ßo"
            }
          ]
        }
      },
      "name": "√â consulta de pre√ßo?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [680, 300]
    },
    {
      "parameters": {
        "functionCode": "// Simular busca no Supabase\nconst produto = $json.mensagem_recebida.toLowerCase().includes('dipirona') ? 'Dipirona' : 'Produto';\n\n// Simular dados do Supabase\nconst resultado = {\n  produto_encontrado: produto,\n  preco: 'R$ 8,50',\n  estoque: 45,\n  laboratorio: 'EMS',\n  disponivel: true\n};\n\nconst resposta = `üîç *Resultados para: ${produto}*\n\nüìç *NOSSA FARM√ÅCIA:*\n‚Ä¢ ${produto} EMS 500mg - ${resultado.preco}\n  ‚úÖ Dispon√≠vel (${resultado.estoque} unidades)\n\nüè™ *OUTRAS FARM√ÅCIAS:*\n‚Ä¢ Drogasil: R$ 9,20 (+R$ 0,70)\n‚Ä¢ Raia: R$ 8,90 (+R$ 0,40)\n\nüí∞ *Voc√™ economiza at√© R$ 0,70 conosco!*\n\nüì± O que deseja fazer?\n1Ô∏è‚É£ Reservar produto\n2Ô∏è‚É£ Ver mais informa√ß√µes\n3Ô∏è‚É£ Falar com farmac√™utico`;\n\nreturn {\n  ...resultado,\n  resposta_formatada: resposta,\n  tipo: 'consulta_preco'\n};"
      },
      "name": "Buscar Produto",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [900, 200]
    },
    {
      "parameters": {
        "functionCode": "// Resposta padr√£o para outras mensagens\nconst resposta = `ü§ñ *FarmaBot - Farm√°cia S√£o Jo√£o*\n\nOl√°! Como posso ajudar voc√™ hoje?\n\nüîç *Consultar pre√ßos*\nüíä *Informa√ß√µes sobre medicamentos*\nüõí *Fazer pedido*\nüìû *Falar com farmac√™utico*\nüìç *Localiza√ß√£o e hor√°rios*\n\nüí° *Exemplo:* Digite \"pre√ßo dipirona\" para consultar pre√ßos!\n\nEstou aqui para ajudar! üòä`;\n\nreturn {\n  resposta_formatada: resposta,\n  tipo: 'menu_principal'\n};"
      },
      "name": "Menu Principal",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [900, 400]
    },
    {
      "parameters": {
        "functionCode": "// Consolidar resposta final\nconst dados = $input.first().json;\n\nreturn {\n  telefone: $('Processar Mensagem').first().json.telefone,\n  resposta: dados.resposta_formatada || dados.resposta,\n  tipo: dados.tipo || 'resposta',\n  timestamp: new Date().toISOString(),\n  sucesso: true\n};"
      },
      "name": "Preparar Resposta",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1120, 300]
    }
  ],
  "connections": {
    "Webhook WhatsApp": {
      "main": [
        [
          {
            "node": "Processar Mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Processar Mensagem": {
      "main": [
        [
          {
            "node": "√â consulta de pre√ßo?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "√â consulta de pre√ßo?": {
      "main": [
        [
          {
            "node": "Buscar Produto",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Menu Principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Produto": {
      "main": [
        [
          {
            "node": "Preparar Resposta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Menu Principal": {
      "main": [
        [
          {
            "node": "Preparar Resposta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  }
}